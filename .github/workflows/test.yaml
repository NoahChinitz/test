# name: 'Commit Message Check'
# on:
#   pull_request:
#     types:
#       - opened
#       - edited
#       - reopened
#       - synchronize
#   push:
#     branches:
#       - main
#       - test

# jobs:
#   check-commit-message:
#     name: Check Commit Message
#     runs-on: ubuntu-latest
#     steps:
#       - name: Check Commit Type
#         uses: gsactions/commit-message-checker@v2
#         with:
#           pattern: '(\[(TEST)-(\d+)\])'
#           flags: 'gm'
#           error: 'Your first line has to contain a commit type like "[TEST-1]".'
#           checkAllCommitMessages: 'true'
#           accessToken: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
# name: 'Flake8 Pull Request Check'
# on:
#   pull_request:
#     types:
#       - opened
#       - edited
#       - reopened
#       - synchronize

# jobs:
#   lint:
#     runs-on: ubuntu-latest
#     steps:
#       - uses: actions/checkout@v1
#       - uses: usama2490/lintly-flake8-github-action@v1.1
#         with:
#           # The GitHub API token to create reviews with
#           token: ${{ secrets.PERSONAL_ACCESS_TOKEN }}
#           args: "--config=.flake8"

name: Check For Jira Key
on:
  pull_request:
    types:
      - opened
      - edited
      - reopened
      - synchronize

jobs:
  Check_Commit:
    runs-on: ubuntu-latest
    name: Commit Checker
    steps:
    - name: Login
      uses: atlassian/gajira-login@v3
      env:
        JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
        JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}
        JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}

    - name: Find in commit messages
      id: find_issue_keys
      uses: atlassian/gajira-find-issue-key@v3
      with:
        from: commits

    - name: Check if Issue Keys Were Found
      run: |
        if [[ "${{ steps.find_issue_keys.outputs.issue-keys-found }}" == "true" ]]; then
          echo "Jira issue keys were found"
        else
          echo "No Jira issue keys were found"
          exit 1
        fi